---
title: "Competition_RegressionSRC"
author: "SRC"
date: "Thursday, April 16, 2015"
output: 
  html_document
    keep_md: yes
---

```{r hiddensetup, echo = FALSE}
require(ggplot2)
require(stringr)
require(plyr)
require(Hmisc)
require(texreg)
options(error=recover)
setwd("K:\\Development\\Competition")
# setwd("C:\\Users\\Greg Sanders\\Documents\\Development\\Fixed-price")
#setwd("C:/Users/scohen/My Documents/Competition/Competition/")
Path<-"K:\\2007-01 PROFESSIONAL SERVICES\\R scripts and data\\"
# Path<-"C:\\Users\\Greg Sanders\\SkyDrive\\Documents\\R Scripts and Data SkyDrive\\"
#path <- "C:/Users/scohen/My Documents/Competition/Competition/"
source(paste(Path,"lookups.r",sep=""))
layout(matrix(c(1,2,3,4),2,2))
```


```{r setup}
MCClist  <- read.csv(
    paste("data\\defense_mcc_competition_combined.csv", sep = ""),
    header = TRUE, sep = ",", dec = ".", strip.white = TRUE, 
    na.strings = c("NULL","NA",""),
    stringsAsFactors = TRUE
    )

MCClist$TotalValue<-MCClist$TotalValue
MCClist<-subset(MCClist,!MajorCommandID %in% c("ORG-2841",
"ORG-2776",
"ORG-4793",
"ORG-2849",
"ORG-2762",
"ORG-4020",
"ORG-2840",
"ORG-2757")
)

ggplot(data=MCClist,aes(x=pEffectiveComp))+geom_bar()
ggplot(data=MCClist,aes(x=sqrt(pEffectiveComp)))+geom_bar()
ggplot(data=MCClist,aes(x=log1p(pEffectiveComp)))+geom_bar()


names(MCClist)

LMsummaryLine<-function(fit,Unit=NULL){
    data.frame(  Equation=as.character(summary(fit)$call)[2],
        Source=as.character(summary(fit)$call)[3],
           Slope=coefficients(fit)[2:length(coefficients(fit))],
           SlopeStdError=summary(fit)$coefficients[2:length(coefficients(fit)),2],
           Intercept=coefficients(fit)[1],         
           AdjRsquared=summary(fit)$adj.r.squared,
            Pvalue=coef(summary(fit))[2:length(coefficients(fit)),4]
           #anova(fit)$'Pr(>F)'[1]


           )
    #Source: http://stackoverflow.com/questions/5587676/pull-out-p-values-and-r-squared-from-a-linear-regression
    #http://stackoverflow.com/questions/23838937/extract-pvalue-from-glm
}

```

Models with pProduct pService and pRnD

```{r PSR}
#
# fit <- lm(y ~ x1 + x2 + x3, data=mydata)

rcorr(as.matrix(subset(MCClist,select=c(pProduct,pService,pRnD))))

ggplot(data=MCClist,aes(x=pAir))+geom_bar(bin=0.01)
ggplot(data=MCClist,aes(x=sqrt(pAir)))+geom_bar(bin=0.01)
ggplot(data=MCClist,aes(x=log1p(pAir)))+geom_bar(bin=0.01)



ggplot(data=MCClist,aes(x=pService,y=pEffectiveComp))+geom_point()
fita <- lm(pEffectiveComp ~ pService, data=MCClist)
summary(fita)    
MCClist$pcService<-MCClist$pService-0.5

summary(MCClist$pcService)
plot(MCClist$pcService)

plot(MCClist$pcService)

ggplot(data=MCClist,aes(x=pcService,y=pEffectiveComp))+geom_point()
fitb <- lm(pEffectiveComp ~ pcService + I(pcService^2), data = MCClist)
summary(fitb)  
plot(fitb)


ggplot(data=MCClist,aes(x=pProduct,y=pEffectiveComp))+geom_point()
fitc <- lm(pEffectiveComp ~ pProduct, data=MCClist)
summary(fitc)   
plot(fitc)

fite <- lm(pEffectiveComp ~ pcService + I(pcService^2) +pRnD, data=MCClist)
summary(fite)
ggplot(data=MCClist,aes(x=pRnD,y=pEffectiveComp))+geom_point()
MCClist$pRnD[MCClist$pRnD<0]<-0
plot(MCClist$pRnD)
plot(fite)

fitf <- lm(pEffectiveComp ~ pRnD, data=MCClist)
plot(fitf)

ggplot(data=MCClist,aes(x=log1p(pRnD),y=pEffectiveComp))+geom_point()
fitd <- lm(pEffectiveComp ~ pcService + I(pcService^2) + pRnD, data=MCClist)
summary(fitd)  
plot(fitd)
screenreg(list(fita, fitb, fitc, fite, fitd))

```

Observations:

1. pService is not statistically significant, and explains only 1% of the variation in pEffectiveComp
2. pcService is significant at the 5% level, explains 25% of the variation in pEffectiveComp and with a one unit increase increases pEffectiveComp by .15.
3. The plot of pcService mildly resembles a quadratic function. pcService^2 is significant at the .001 level and with pcService explains 25% of the variation in pEffectiveComp.  It istimates that an increase in pcService will result in a 1.25 increase in pEffectiveComp
4. pProduct is not statistically significant nor does it explain any of the variation in pEffectiveComp.  
5. pRnD is not statistically significant 
6.pRnD does not resemble a squareroot relationship and as can be seen in fitd, it impacts the model significantly 

7. sqrt(pRnD) is significant at the .05 level and the addition of these two variables increases r^2 from .25 to .35.  However, the standard error for sqrt(pRnD) is quite large (.32)

```{r Platform}

rcorr(as.matrix(subset(MCClist,select=c(pService,pRnD,pFnC,pAir,pVessel,pLand,pWnA,pMnS,pEnC))))
rcorr(cbind(MCClist$pFnC,MCClist$pService^2))


ggplot(data=MCClist,aes(x=pAir,y=pEffectiveComp))+geom_point()
ggplot(data=MCClist,aes(x=sqrt(pAir),y=pEffectiveComp))+geom_point()

fita <- lm(pEffectiveComp ~ pcService, data=MCClist)
fitb <- lm(pEffectiveComp ~ pcService + I(pcService^2), data=MCClist)
#fitd <- lm(pEffectiveComp ~ pcService + I(pcService^2) + pRnD, data=MCClist)
#fite <- lm(pEffectiveComp ~ pcService + I(pcService^2) + pRnD+ sqrt(pRnD), data=MCClist)
afit <- lm(pEffectiveComp ~ pcService+I(pcService^2)+ pAir, data=MCClist)
plot(MCClist$pAir)
bfit <- lm(pEffectiveComp ~ pcService+I(pcService^2)+ pAir+sqrt(pAir), data=MCClist) 
plot(afit)
summary(bfit) 
plot(bfit)
plot(fita)
screenreg(list(fita, fitb, afit, bfit))

```

Obersvations

1. pAir increases R^s by .1 and decreases the coefficient of pcService^2 by .01.  PAir itself is significant.  
2.the plot of pAir does not resemble a squareroot function.
3. sqrt(pAir) increases pcService^2 by .05, is not statistically significant and increases r^2 by .01.  Thus between these descriptive statistics and the plot of pAir, it should not be included further in the model. 

```{r pVessel with pProduct}
ggplot(data=MCClist,aes(x=pVessel,y=pEffectiveComp))+geom_point()
ggplot(data=MCClist,aes(x=sqrt(pVessel),y=pEffectiveComp))+geom_point()

ggplot(data=MCClist,aes(x=pVessel))+geom_bar(bin=0.01)
ggplot(data=MCClist,aes(x=sqrt(pVessel)))+geom_bar(bin=0.01)
ggplot(data=MCClist,aes(x=log1p(pVessel)))+geom_bar(bin=0.01)

fitc <- lm(pEffectiveComp ~ pProduct, data=MCClist)
fit5 <- lm(pEffectiveComp ~ pProduct+ pAir, data=MCClist)
fit6 <- lm(pEffectiveComp ~ pProduct+ pAir, data=MCClist)
#fit7 <- lm(pEffectiveComp ~ pProduct+ pRnD+ sqrt(pRnD)+ pAir, data=MCClist)
fit1 <- lm(pEffectiveComp ~ pProduct+ pAir+ pVessel, data=MCClist)
summary(fitc)
summary(fit6)
summary(fit7)
summary(fit1) 
screenreg(list(fitc, fit5, fit6, fit1))
```

Observations:

1. pproduct is not significant in any of these models and in model 5 has p value of .7
2. The addition of pVessel does not change any of the coefficients or statistics by any meaningful value. 


```{r pVessel with pService}
afit <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir, data=MCClist) 
fit2 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir+ pVessel, data=MCClist)
plot(fit2)
fit8 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir+ pVessel+ sqrt(pVessel), data=MCClist)
plot(MCClist$pVessel)
fit4 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir+ pVessel+ sqrt(pVessel), data=MCClist[rownames(MCClist)!=58,])
summary(afit)
summary(fit2)
summary(fit8)
summary(fit4)
screenreg(list(afit, fit2, fit8, fit4))

```

Observations

1. pVessel does not change the r^2, the value or significance of pcService^2 nor is it significant
2. The plot of pVessel barely resembles a squareroot function.  sqrt(pVessel) does not change r^2, increases pcService by .09, and is not significant. And although it increases r^2, adjusted r^2 across the models does not change THUS indicating that the addition of vessel and sqrt(vessel) does not help increase the explanation of effected comp given the variables.
3. removing outliers decreases the value of sqrt(pVessel) by .78, does not increase significance, nor does it increase r^2 and it decreases pcService by .03.  It also has avery high standard error of .77


```{r pLand}

ggplot(data=MCClist,aes(x=pLand,y=pEffectiveComp))+geom_point()
ggplot(data=MCClist,aes(x=sqrt(pLand),y=pEffectiveComp))+geom_point()
ggplot(data=MCClist,aes(x=log1p(pLand),y=pEffectiveComp))+geom_point()
ggplot(data=MCClist,aes(x=pLand,y=pEffectiveComp))+geom_point()

bfit <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir, data=MCClist)  
afit1 <- lm(pEffectiveComp ~ pcService+I(pcService^2)+ pAir+ pLand, data=MCClist)
summary(bfit)
summary(afit1) 
plot(afit1)
screenreg(list(bfit, afit1))

plot(MCClist$pLand)
afit2 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pLand+ sqrt(pLand), data=MCClist)
summary(afit2) 
plot(afit2)
screenreg(list(bfit, afit1, afit2))

```

Observations

1. Adding pLand does not change any coefficients or descriptive statistics  
2. pLand only very slightly resembles a square root function but since sqrt(pLand) increases r^2 by .02 and increases the coefficient of pcService^2 by .05 it should not be further described as one. 


```{r MnS}

ggplot(data=MCClist,aes(x=pMnS,y=pEffectiveComp))+geom_point()
ggplot(data=MCClist,aes(x=sqrt(pMnS),y=pEffectiveComp))+geom_point()

bfit <- lm(pEffectiveComp ~ pcService+I(pcService^2)+ pAir, data=MCClist)  

bfit1 <- lm(pEffectiveComp ~ pcService+I(pcService^2)+ pAir+ pMnS, data=MCClist)
summary(bfit1) 

bfit2 <- lm(pEffectiveComp ~ pcService+I(pcService^2)+ pAir+ pMnS+ pVessel, data=MCClist)
summary(bfit)
summary(bfit1)
plot(bfit2)
screenreg(list(bfit, bfit1, bfit2))   

bfit3 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir, data=subset(MCClist,                                                                                    rownames(MCClist)!=58))
summary(bfit3) 
plot(bfit3)

bfit4 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pMnS, data=subset(MCClist,                                                                                    rownames(MCClist)!=58))
summary(bfit4)
summary(bfit1)
bfit5 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir+ pMnS+ pVessel, data=subset(MCClist,                                                                                    rownames(MCClist)!=58))
summary(bfit5)
summary(bfit4)
screenreg(list(bfit, bfit1, bfit2, bfit3, bfit4, bfit5))

```

Observations

1. pMns increases the r^2 from .35 to .39, is significant at the 10% level (p=.092), decreases the p value for pcservice^2 by .13 
2. pMnS increases signifiance when pVessel is added when eliminating the outlier (p=.07).  the coefficient of pcService^2 decreases by .05 when the outlier is removed.  The r^2 between model with outlier and model without does not change.  comparing the models with and without the outlier when pvessel, the coefficient is the same but with an opposite sign (?). (don't use vessel) The biggest change to note here is the increase in significance of pMnS when accounting for the outlier and adding pVessel


```{r pWnA}


ggplot(data=MCClist,aes(x=pWnA,y=pEffectiveComp))+geom_point()
ggplot(data=MCClist,aes(x=sqrt(pWnA),y=pEffectiveComp))+geom_point()
cfit7 <- lm(pEffectiveComp ~ pcService+I(pcService^2)+ pAir, data=MCClist) 

cfit1 <- lm(pEffectiveComp ~ pcService+I(pcService^2)+ pAir+ pMnS, data=MCClist) 

cfit3 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir+ pWnA, data=MCClist)

cfit2 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pMnS +pWnA, data=MCClist)
summary(cfit1)
summary(cfit3)
summary(cfit2)
screenreg(list(cfit7, cfit1, cfit3, cfit2))

```

Observations:
 keep missiles and space nothing against it..
1.  pMnS is included because it decreasres the coefficient of pcservice^2 by .13, increases r^2 by .04 and is itself negative, which hteoretically makes sense (missiles and space are an industry with zero competition) 
2. pWnA is statistically significant, increases r^2, decreases pcService^2 by .28.  Thus is should be continued further in the model.
3. pWnA is very siginificant (p=.005) and increases the r^2 of the model (.39->.46).  
4.  pMnS and pWnA will continue in the model. 


```{r ElectronicAndCommunications}

ggplot(data=MCClist,aes(x=pEnC,y=pEffectiveComp))+geom_point()
ggplot(data=MCClist,aes(x=sqrt(pEnC),y=pEffectiveComp))+geom_point()
ggplot(data=MCClist,aes(x=log1p(pEnC),y=pEffectiveComp))+geom_point()

dfit1 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir+ pMnS+ pWnA, data=MCClist)
summary(dfit1) 
plot(dfit1)

dfit2 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir+ pMnS+ pWnA+ pEnC, data=MCClist)
summary(dfit2) 
plot(dfit2)
screenreg(list(dfit1, dfit2))

dfit3 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir+ pMnS+ pWnA +pEnC +pVessel, data=subset(MCClist, rownames(MCClist)!=58 ))
summary(dfit3) 
plot(dfit3)
screenreg(list(dfit1, dfit2, dfit3))
 
```
Observations

1. Adding pEnC does not influence r^2 by much (increase by .03) and it decreases the coefficient of pcService^2 by .11.  It is also not significant (p=.112).
2. When looked at with vessel and romoving the outlier, neither pEnC nor pVessel is significant, the r^2 does not change.  
3. Adding pEnC decreases pcService^2 by .11. This could merit inclusion

```{r FacilityAndConstruction}

ggplot(data=MCClist,aes(x=pFnC,y=pEffectiveComp))+geom_point()
ggplot(data=MCClist,aes(x=sqrt(pFnC),y=pEffectiveComp))+geom_point()
ggplot(data=MCClist,aes(x=log1p(pFnC),y=pEffectiveComp))+geom_point()


efit1 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir+ pWnA+ pEnC, data=MCClist)
summary(efit1) 
plot(efit1)

efit2 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir+ pWnA+ pWnA+ pEnC + pFnC, data=MCClist)
summary(efit2) 
plot(efit2)
screenreg(list(efit1, efit2))

efit3 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir+ +pWnA+ pEnC+ pFnC+ pVessel, data=MCClist)
summary(efit3) 
plot(efit3)
screenreg(list(efit1, efit2, efit3))

efit4 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir+ pWnA + pEnC+ pFnC+ pVessel, data=subset(MCClist, rownames(MCClist)!=58 & rownames(MCClist)!=59 ))
summary(efit2) 
plot(efit4)
screenreg(list(efit1, efit2, efit3, efit4))

##the addition of pFnC increases r^2 by .02, increases coefficients pcService^2 by .05, decreases the significance of sqrt(pRnD) and does not change the other variables significantly.  when vessel is added, r^2 does not change, and neither do any other coefficients to a large extent.  When the outlier is eliminated, the sign of pVessel changes to positive and increases by .51, however, it is not significant (p=.376).  thus, I do not think pFnC should continue as part of the model.  
```

Observations:

1. The addition of pFnC increases r^2 by .01, decreases the coefficient on pcService^2 by .02.  
2. When Vessel is added, r^2 increases by .01, and and dont change any of the other coefficients to a large extent.  
3. When the outlier is eliminated, the sign of pVessel changes to positive and increases by .55, however, it is not significant (p=.376).  
4.  This leads me to say that pFnC should not be included in the model


```{r IDV}
rcorr(as.matrix(subset(MCClist,select=c(pService,pRnD,pAir,pLand,pWnA,pMnS,pEnC,pIDV,pFixed,pCostPlus,pIncentFee))))


ggplot(data=MCClist,aes(x=pIDV,y=pEffectiveComp))+geom_point()

ffit1 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pWnA+ pEnC, data=MCClist)
summary(ffit1) 
plot(ffit1)

ffit2 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pWnA+ pEnC+ pIDV, data=MCClist)
           
summary(ffit2) 
plot(ffit2)
screenreg(list(ffit1, ffit2))  
```

Observations:

1. pIdv increases r^2 by .04, decreases the coefficient of pcService^2 by .08, maintains statisticaly significant coefficients on the other variables and is itsefl statistically significant at the 5% level, thus IDV should be included in the model.


```{r FixedPrice}
ggplot(data=MCClist,aes(x=pFixed,y=pEffectiveComp))+geom_point()

gfit2 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pWnA + pEnC+ pIDV, data=MCClist)

gfit1 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir+ pWnA+ pEnC+ pIDV+ pFixed, data=MCClist)
summary(gfit1) 
plot(gfit1)
screenreg(list(gfit2, gfit1))

```


Observations:

1. With the addition of pFixed, the r^2 does not change, the coefficient of pcService^2 increases by .02 and doesn't affect the model otherwise.  It is also not statistically significant. Should not be continued in the model. 


```{r CostPlus}
ggplot(data=MCClist,aes(x=pFixed,y=pEffectiveComp))+geom_point()

hfit1 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir+ pWnA+ pEnC+ pIDV, data=MCClist)
summary(hfit1) 
plot(hfit1)

hfit2 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pWnA+ pEnC+ pIDV+ pCostPlus, data=subset(MCClist,!rownames(MCClist) %in% c(59) ))
summary(hfit2) 
plot(hfit2)
screenreg(list(hfit1, hfit2)) 
```

Observations:

1.pCostPlus decreases r^2 by .07, is not statistically significant (p= 0.7397), increases the coefficient of pcService&2 by .05 and does not change other factors of the model significantly. Based on this information, the team decided to leave CostPlus out. 

```{r IncentiveFee}

ifit1 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pWnA + pEnC + pIDV, data=MCClist)
summary(ifit1) 
plot(ifit1)

ifit2 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pWnA + pEnC + pIDV+ pIncentFee, data=MCClist)
summary(ifit2) 
plot(ifit2)
screenreg(list(ifit1, ifit2))


```

Observations:

1. the addition of incentive fee into the model does not change the coefficients of the other variables, does not change the r^2 values nor is it significant.  Thus, it will not be further included in the model. 

```{r TotalCount}

rcorr(as.matrix(subset(MCClist,select=c(pService,pRnD,pAir,pLand,pWnA,pMnS,pEnC,pIDV,TotalCount,TotalValue,avSize))))

ggplot(data=MCClist,aes(x=TotalCount))+geom_bar()
ggplot(data=MCClist,aes(x=log(TotalCount)))+geom_bar()
ggplot(data=MCClist,aes(x=TotalCount,y=pEffectiveComp))+geom_point()
ggplot(data=MCClist,aes(x=log(TotalCount),y=pEffectiveComp))+geom_point()

jfit1 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pWnA + pEnC + pIDV, data=MCClist)
summary(jfit1)
plot(jfit1)


ggplot(data=MCClist,aes(x=TotalCount))+geom_bar()
ggplot(data=MCClist,aes(x=log(TotalCount)))+geom_bar()
ggplot(data=MCClist,aes(x=TotalCount,y=pEffectiveComp))+geom_point()
ggplot(data=MCClist,aes(x=log(TotalCount),y=pEffectiveComp))+geom_point()

jfit2 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pWnA + pEnC + pIDV+ TotalCount, data=MCClist)
summary(jfit2)
plot(jfit2)

jfit3 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pWnA + pEnC + pIDV+ log(TotalCount), data=MCClist)
summary(jfit3)
screenreg(list(jfit1, jfit2, jfit3))


```

Observations:

1.total count does not change the model in anyway, and it's interesting to note that its coefficients are zero.
2. Log of total count decreases the coefficient on pcservice^2 by .01
3. neither total count nor log(total count) should be included in the model. 


```{r TotalValue}

rcorr(as.matrix(subset(MCClist,select=c(pService,pRnD,pAir,pLand,pWnA,pMnS,pEnC,pIDV,TotalCount,TotalValue,avSize))))

ggplot(data=MCClist,aes(x=TotalValue))+geom_bar()
ggplot(data=MCClist,aes(x=log(TotalValue)))+geom_bar()
ggplot(data=MCClist,aes(x=TotalValue,y=pEffectiveComp))+geom_point()
ggplot(data=MCClist,aes(x=log(TotalValue),y=pEffectiveComp))+geom_point()

kfit1 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pWnA + pEnC + pIDV, data=MCClist)

kfit2 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pWnA + pEnC + pIDV+ log(TotalValue), data=MCClist)
summary(kfit2)
plot(kfit2)

kfit3 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pWnA + pEnC + pIDV+ log(TotalValue) + log(TotalValue):I(pcService^2), data=subset(MCClist, rownames(MCClist)!=26))
summary(kfit3)
plot(kfit3)

kfit4 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pWnA + pEnC + pIDV+ log(TotalValue), data=subset(MCClist, rownames(MCClist)!=26))
summary(kfit4)
plot(kfit4)

kfit5 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pWnA + pEnC + pIDV+ log(TotalValue), data=subset(MCClist, rownames(MCClist)!=26&rownames(MCClist)!=58))
summary(kfit5)
plot(kfit5)


screenreg(list(kfit1, kfit2, kfit3, kfit4, kfit5)) 
```

Observations:

1. log(Total value) increases the coefficient of pcService^2 by .01, is not statistically significant and does not change the r^2 value.
2. I(pcService^2):log(TotalValue) decreases the significance of service coefficients, does not change r^2 and itself is not significant.
3. Subsetting the data frame in models 4 and 5 do not change r^2, significances of other coefficient nor does it change any coefficients in either direction. 
4. Thus, out of these models, total value should not be included futher 


```{r AverageSize}

lfit1 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pWnA + pEnC + pIDV, data=MCClist)
summary(lfit1)

lfit2 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pWnA + pEnC + pIDV+ avSize, data=MCClist)
summary(lfit2) 
plot(lfit2)


lfit3 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir+ pWnA+ pEnC+ pIDV+ lavSize, data=MCClist)
summary(lfit3) 
plot(lfit3)

rcorr(as.matrix(subset(MCClist,select=c(pService,pRnD,pAir,pLand,pWnA,pMnS,pEnC,pIDV,TotalCount,TotalValue,avSize))))

ggplot(data=MCClist,aes(x=avSize))+geom_bar()
ggplot(data=MCClist,aes(x=log(avSize)))+geom_bar()
ggplot(data=MCClist,aes(x=avSize,y=pEffectiveComp))+geom_point()
ggplot(data=MCClist,aes(x=log(avSize),y=pEffectiveComp))+geom_point()

lfit4 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pWnA + pEnC + pIDV+ log(avSize), data=MCClist)
summary(lfit4)
plot(lfit4)

lfit5 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir+ pWnA+ pEnC + pIDV+ log(avSize), data=subset(MCClist, rownames(MCClist)!=26))
summary(lfit5)
plot(lfit5)


lfit6 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir+ pWnA+ pEnC + pIDV+ log(avSize)+ pVessel, data=subset(MCClist, rownames(MCClist)!=26&rownames(MCClist)!=59))
summary(lfit6)
plot(lfit6)


lfit7 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir+ pWnA+ pEnC+ log(avSize)+ pVessel+ pIDV:I(pcService^2), data=MCClist)
summary(lfit7) 
plot(lfit7)


lfit8 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir+ pWnA+ pEnC+ log(avSize)+ pVessel + pIDV:I(pcService^2)+ pIDV:pcService, data=MCClist)
summary(lfit8) 
plot(lfit8)
screenreg(list(lfit1, lfit2, lfit3, lfit4, lfit5, lfit6, lfit7, lfit8))

```

Observations: **another item to discuss**

1. adding average size decreases pservice^2 by .01 and otherwise has no impact on the model and itself is not significant
2.  Adding log(avSize) has no impact
3. The rest of the additions/modifications do not contribute in a way that merits further inclusion.
4. Because log(avSize) does not change the r^2, is itself not significant and only changes the coefficient of pcService^2 by .04 I do not think it should continue.   
5. Model 6 decreases r^2 by .08 and decreases the significance and value of pWnA by .23.  This model adds I(pcService^2):pIDV

###final model
``` {r}
jfit 1

jfit1 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pWnA + pEnC + pIDV, data=MCClist)
summary(jfit1)
screenreg(list(jfit1))

```

###data exploration
``` {r echo=TRUE}

ECmean <- mean(MCClist$pEffectiveComp)

##effective competition
hist(MCClist$pEffectiveComp, probability=T, breaks = 30, main="Distribution of Effective Competition", col = "light blue", xlim=c(0, 1), xlab="Effective Competition", ylab = "Frequency")
abline(v = ECmean, col = "blue", lwd = 3)

qplot(MCClist$pEffectiveComp, geom = "histogram", binwidth = .03, main = "Distribution of Effective Competition", xlab = "Effective Competition", fill = I("light blue"), col = I("red"), aplpha = .2, xlim = c(0, 1))

boxplot(MCClist$pEffectiveComp, col=(c("orange", "orange")), main = "Effective Competition", xlab = "percent of contract value out of total obligation", horizontal = TRUE)

##pcService

boxplot(MCClist$pcService, col=(c("light blue", "light blue")), main = "Type of Good Procured: Service", xlab = "percent of contract obligations spent on Services", horizontal = TRUE)

qplot(MCClist$pcService, geom = "histogram", binwidth = .03, main = "Distribution of Service", xlab = "Type of Good Procured: Service", fill = I("light blue"), col = I("red"), aplpha = .2, xlim = c(0, 1))

##pAir

boxplot(MCClist$pAir, col=(c("yellow", "yellow")), main = "Platform Portfolio: Air", xlab = "percent of contract obligations spent on Air", horizontal = TRUE)

qplot(MCClist$pAir, geom = "histogram", binwidth = .03, main = "Distribution of Air", xlab = "Type of Product Procured: Air", fill = I("light blue"), col = I("red"), aplpha = .2, xlim = c(0, 1))

##PWnA

boxplot(MCClist$pWnA, col=(c("green", "green")), main = "Platform Portfolio: Weapons and Ammunition", xlab = "percent of contract obligations spent on Weapons and Ammunition", horizontal = TRUE)

qplot(MCClist$pWnA, geom = "histogram", binwidth = .03, main = "Distribution of Weapons and Ammunition", xlab = "Platform Portfolio: Weapons and Ammunition", fill = I("light blue"), col = I("red"), aplpha = .2, xlim = c(0, 1))

##pEnC

boxplot(MCClist$pEnC, col=(c("pink", "pink")), main = "Platform Portfolio: Electronics and Communication", xlab = "percent of contract obligations spent on Electronics and Communication", horizontal = TRUE)

qplot(MCClist$pEnC, geom = "histogram", binwidth = .03, main = "Distribution of Electronics and Communication", xlab = "Platform Portfolio: Electronics and Communications", fill = I("light blue"), col = I("red"), aplpha = .2, xlim = c(0, 1))

##pIDV

boxplot(MCClist$pIDV, col=(c("light purple", "light purple")), main = "Contracting Methods: Contract Vehicle", xlab = "percent of contract obligations spent on Contract Vehicle", horizontal = TRUE)

qplot(MCClist$pIDV, geom = "histogram", binwidth = .03, main = "Distribution of Contract  Vehicle", xlab = "Contracting Method: Contract Vehicle", fill = I("light blue"), col = I("red"), aplpha = .2, xlim = c(0, 1))


```

###final model exploration:
``` {r echo = TRUE}

jfit1 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pAir + pWnA + pEnC + pIDV, data=MCClist)

plot(jfit1)

##residual plot
##http://www.r-bloggers.com/ggplot2-version-of-figures-in-%E2%80%9C25-recipes-for-getting-started-with-r%E2%80%9D/


ggplotRegression <- function (fit) {

require(ggplot2)

ggplot(fit$model, aes_string(x = names(fit$model)[2], y = names(fit$model)[1])) + 
  geom_point() +
  stat_smooth(method = "lm", col = "green") +
  labs(title = paste("Adj R2 = ",signif(summary(fit)$adj.r.squared, 5),
                     "Intercept =",signif(fit$coef[[1]],5 ),
                     " Slope =",signif(fit$coef[[2]], 5),
                     " P =",signif(summary(fit)$coef[2,4], 5)))
}

ggplotRegression(jfit1)



```


###State Level
```{r StateValidation}
mfit1 <- lm(pEffectiveComp ~ pcService, data=MCClist)
summary(mfit1) 
plot(mfit1)


StateList  <- read.csv(
    paste("data\\defense_state_competition_combined.csv", sep = ""),
    header = TRUE, sep = ",", dec = ".", strip.white = TRUE, 
    na.strings = c("NULL","NA",""),
    stringsAsFactors = TRUE
    )
names(StateList)


StateList <-subset(StateList ,!PoPstateCode %in% c("VI",
"AS",
"MP",
"AE",
"PW",
"US",
"UK",
"GM",
"GB",
"JA",
"ON",
"QC",
"   ",
"BC"))

rcorr(as.matrix(subset(StateList,select=c(pService,pProduct,pRnD,pAir,pLand,pVessel,pWnA,pFnC,pMnS,pEnC,pIDV,pFixed,pCostPlus,TotalCount,TotalValue,avSize))))

StateList$pcService<-StateList$pService-0.5
mfit1 <- lm(pEffectiveComp ~ pcService, data=StateList)

StateList$pcService<-StateList$pService-0.5
mfit2 <- lm(pEffectiveComp ~ pcService + I(pcService^2), data=StateList)
summary(mfit2) 
plot(mfit2)

screenreg(list(mfit1, mfit2))

##using statelist certainly yields very different results. 

mfit3 <- lm(pEffectiveComp ~ pcService + I(pcService^2) + pRnD, data=StateList)
summary(fit) 
plot(mfit3)


mfit4 <- lm(pEffectiveComp ~ pcService+I(pcService^2)+ pRnD+ pAir, data=StateList)
summary(mfit4) 
plot(mfit4)

screenreg(list(mfit1, mfit2, mfit3, mfit4))
```
Observations:

1. pcService by itself is not statistically significant nor does it have an r^2 (.01).  
2. when pcService^2 is added, pcService increases to .53, is statistically significant (.001%) and the r^2 increases is .52.
3. pRnD decreases pcService by .05, increases adjusted r^2 by .01 and is not statistically significant. Because it decreases pcService by .05 it should be continued in the model.
4. pAir increases r^2 by .1, is statistically significant and decreases the coefficient of pcService by .11 and shoudl be continued. 


```{r echo= TRUE}

mfit5 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pRnD+ pAir+ pVessel, data=StateList)
summary(mfit5) 
plot(mfit5)

screenreg(list(mfit1, mfit2, mfit3, mfit4, mfit5))

```
observations:

1. pVessel is not statistically significant, it does not change the coefficient on pcService by more than .01 nor does it change the r^2 or other variable's coefficients. It should not be continued in the model

```{r echo=TRUE}

mfit6 <- lm(pEffectiveComp ~ pcService+I(pcService^2)+ pRnD+ pAir+ pLand, data=StateList)
summary(mfit6) 
plot(mfit6)

screenreg(list(mfit1, mfit2, mfit3, mfit4, mfit6))
```
oBSERVATIONS:
1. pLand increases r^2 by .02, adjusted r^2 by .01, decreases coefficient of pcService by .06 and is not statistically significant.  
2. because of its effect on pcService, it should be included.

```{r echo=TRUE}

mfit7 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pRnD+ pAir + pLand+ pMnS, data=StateList)
summary(mfit7) 
plot(mfit7)

screenreg(list(mfit1, mfit2, mfit3, mfit4, mfit6, mfit7))
```
observations:
1. pMnS does not change any part of the model that merits its inclusion. and is not statistically significant


```{r echo=TRUE}

mfit8 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pRnD+ pAir + pLand + pWnA, data=StateList)
summary(mfit8) 
plot(mfit8)

screenreg(list(mfit1, mfit2, mfit3, mfit4, mfit6, mfit8))
```
Observations:
1. PWnA does not change r^2 or adjusted r^2, decreases pcService by .02 and is not statistically significant, it should not be included in the model.


```{r echo=TRUE}

mfit9 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pRnD+ pAir + pLand + pIDV, data=StateList)
summary(mfit9) 
plot(mfit9)

screenreg(list(mfit1, mfit2, mfit3, mfit4, mfit6, mfit9))
```
Observations:
1. pIDV does not impact r^2 significantly (.66-.67)
2. pIDV does not impace pcService significantly (.31-.30)
3. pIDV is not statistically significant. Thus pIDV will not further be included


```{r echo=TRUE}

mfit10 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pRnD+ pAir+ pLand + pFixed, data=StateList)
summary(mfit10) 
plot(mfit10)

screenreg(list(mfit1, mfit2, mfit3, mfit4, mfit6, mfit10))
```
Observations:
1. pFixed increases r^2 by .02 and adjusted r^2 by .02.
2. it also increase pCService by .07.  
3. it itselft is not statistically significant but has a p-value of .0774
4. it should be included in the model

```{r echo=TRUE}

mfit11 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pRnD+ pAir + pLand + pFixed + pCostPlus, data=StateList)
summary(mfit11)

screenreg(list(mfit1, mfit2, mfit3, mfit4, mfit6, mfit10, mfit11))
```
Observations:
1. pCostplus does not hcange r^2 or adjusted r^2
2. if does not change pcService
3. It also is not statistically significant
it should not be included in the model


```{r echo=TRUE}

mfit12 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pRnD+ pAir + pLand+ pFixed+ pIncentFee, data=StateList)
summary(mfit12)

screenreg(list(mfit1, mfit2, mfit3, mfit4, mfit6, mfit10, mfit12))
```
Observations:
1. pcService decreases by .02 with the addition of incenteive fee
2. r^2 does not change
3. incentive fee is not statistically significant 
4. incentive fee will not be included further


```{r echo=TRUE}


mfit13 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pRnD+ pAir + pLand + pFixed+ TotalCount, data=StateList)

screenreg(list(mfit1, mfit2, mfit3, mfit4, mfit6, mfit10, mfit13))
```
Observations
1. TotalCount does not change pcService
2. Totalcount does not change r^2 and decreases adjusted r^2 by .01
2. total count is not statistically significant nor does it have any affect on effectivecomp according to its coefficient (00.00)


```{r echo=TRUE}

mfit14 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pRnD+ pAir + pLand + pFixed+ log(TotalValue), data=StateList)

screenreg(list(mfit1, mfit2, mfit3, mfit4, mfit6, mfit10, mfit14))
```
not significant

```{r echo=TRUE}

mfit15 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pRnD+ pAir + pLand + pFixed+ log(TotalValue)+ log(avSize), data=StateList)


screenreg(list(mfit1, mfit2, mfit3, mfit4, mfit6, mfit10, mfit15))


```
not significant


###final model
```{r echo=TRUE}



#mfit10 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pRnD+ pAir+ pLand + pFixed, data=StateList)

mfit10 <- lm(pEffectiveComp ~ pcService+ pRnD+ pAir+ pLand + pFixed, data=StateList)

summary(mfit10)


screenreg(list(mfit1, mfit2, mfit3, mfit4, mfit6, mfit10))

screenreg(mfit10)


```


###data exploration
``` {r echo=TRUE}

ECmean1 <- mean(StateList$pEffectiveComp)

##effective competition
hist(StateList$pEffectiveComp, probability=T, breaks = 30, main="Distribution of Effective Competition", col = "light blue", xlim=c(0, 1), xlab="Effective Competition", ylab = "Frequency")
abline(v = ECmean1, col = "blue", lwd = 3)

qplot(StateList$pEffectiveComp, geom = "histogram", binwidth = .03, main = "Distribution of Effective Competition", xlab = "Effective Competition", fill = I("light blue"), col = I("red"), aplpha = .2, xlim = c(0, 1))

boxplot(StateList$pEffectiveComp, col=(c("orange", "orange")), main = "Effective Competition", xlab = "percent of contract value out of total obligation", horizontal = TRUE)

##pcService

boxplot(StateList$pcService, col=(c("light blue", "light blue")), main = "Type of Good Procured: Service", xlab = "dollars spent on services", horizontal = TRUE)

qplot(StateList$pcService, geom = "histogram", binwidth = .03, main = "Distribution of Service", xlab = "Type of Good Procured: Service", fill = I("light blue"), col = I("red"), aplpha = .2, xlim = c(0, 1))

##pAir

boxplot(StateList$pAir, col=(c("yellow", "yellow")), main = "Platform Portfolio: Air", xlab = "percent of contract obligations spent on Air", horizontal = TRUE)

qplot(StateList$pAir, geom = "histogram", binwidth = .03, main = "Distribution of Air", xlab = "Type of Product Procured: Air", fill = I("light blue"), col = I("red"), aplpha = .2, xlim = c(0, 1))

##PRnD

boxplot(StateList$pRnD, col=(c("green", "green")), main = "Type of Good Procured: Research and Development (R&D)", xlab = "percent of contract obligations spent on R&D", horizontal = TRUE)

qplot(StateList$pRnD, geom = "histogram", binwidth = .03, main = "Distribution of Research and Development (R&D)", xlab = "Type of Good Procured: R&D", fill = I("light blue"), col = I("red"), aplpha = .2, xlim = c(0, 1))

##pLand

boxplot(StateList$pLand, col=(c("pink", "pink")), main = "Platform Portfolio: Land Vehicles", xlab = "percent of contract obligations spent on Land Vehicles", horizontal = TRUE)

qplot(StateList$pLand, geom = "histogram", binwidth = .03, main = "Distribution of Land Vehicles", xlab = "Platform Portfolio: Land", fill = I("light blue"), col = I("red"), aplpha = .2, xlim = c(0, 1))

##Fixed

boxplot(StateList$pFixed, col=(c("violet", "violet")), main = "Contracting Methods: Fixed Price", xlab = "percent of contract obligations spent on Fixed Price", horizontal = TRUE)

qplot(StateList$pFixed, geom = "histogram", binwidth = .03, main = "Distribution of Fixed Price", xlab = "Contracting Method: Fixed Price", fill = I("violet"), col = I("red"), aplpha = .2, xlim = c(0, 1))


```

###final model exploration:
``` {r echo = TRUE}

mfit10 <- lm(pEffectiveComp ~ pcService+ I(pcService^2)+ pRnD+ pAir+ pLand + pFixed, data=StateList)

summary(mfit10)

##residual plot
##http://www.r-bloggers.com/ggplot2-version-of-figures-in-%E2%80%9C25-recipes-for-getting-started-with-r%E2%80%9D/


ggplotRegression <- function (fit) {

require(ggplot2)

ggplot(fit$model, aes_string(x = names(fit$model)[2], y = names(fit$model)[1])) + 
  geom_point() +
  stat_smooth(method = "lm", col = "green") +
  labs(title = paste("Adj R2 = ",signif(summary(fit)$adj.r.squared, 5),
                     "Intercept =",signif(fit$coef[[1]],5 ),
                     " Slope =",signif(fit$coef[[2]], 5),
                     " P =",signif(summary(fit)$coef[2,4], 5)))
}

ggplotRegression(mfit10)



```

